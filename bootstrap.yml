- name: Configure everything
  hosts: localhost
  remote_user: jani
  become: yes

  tasks:
  - name: Gather package facts
    package_facts:
      manager: apt

  - name: Add Sublime HQ apt key
    ansible.builtin.get_url:
      url: https://download.sublimetext.com/sublimehq-pub.gpg
      dest: /etc/apt/keyrings/sublime-text.asc
  - name: Add Sublime HQ apt repository
    ansible.builtin.apt_repository:
      repo: deb [signed-by=/etc/apt/keyrings/sublime-text.asc] https://download.sublimetext.com/ apt/stable/
      state: present
      filename: sublime-text

  - name: Add Keybase apt key
    ansible.builtin.get_url:
      url: https://keybase.io/docs/server_security/code_signing_key.asc
      dest: /etc/apt/keyrings/keybase.asc
  - name: Add Keybase apt repository
    ansible.builtin.apt_repository:
      repo: deb [signed-by=/etc/apt/keyrings/keybase.asc] http://prerelease.keybase.io/deb stable main
      state: present
      filename: keybase
  - name: Touch /etc/default/keybase to avoid automatic repo configuration # see https://keybase.io/docs/the_app/install_linux
    ansible.builtin.file:
      path: /etc/default/keybase
      state: touch
    when: '"keybase" not in ansible_facts.packages'

  - name: Add Wire apt key
    ansible.builtin.get_url:
      url: https://wire-app.wire.com/linux/releases.key
      dest: /etc/apt/keyrings/wire.asc
  - name: Add Wire apt repository
    ansible.builtin.apt_repository:
      repo: deb [signed-by=/etc/apt/keyrings/wire.asc] https://wire-app.wire.com/linux/debian stable main
      state: present
      filename: wire-desktop

  - name: Install packages with apt
    ansible.builtin.apt:
      name:
        - apt-transport-https
        - bat
        - binwalk
        - blueman
        - build-essential
        - command-not-found
        - curl
        - direnv
        - dnsutils
        - exiftool
        - firefox-esr
        - fonts-font-awesome
        - fonts-noto
        - fonts-noto-color-emoji
        - fwupd
        - fzf
        - gimp
        - git
        - gnupg2
        - google-chrome-stable
        - grim
        - hexyl
        - httpie
        - jid
        - jq
        - kanshi
        - keybase
        - libpam-u2f
        - lightdm
        - logiops
        - mate-polkit
        - materia-gtk-theme
        - mesa-utils
        - meson
        - neofetch
        - network-manager-gnome
        - ninja-build
        - nodejs
        - playerctl
        - psmisc
        - python3
        - python3-pip
        - python3-venv
        - qalc
        - ranger
        - ripgrep
        - scdoc
        - slurp
        - ssh-audit
        - sshfs
        - sublime-merge
        - sublime-text
        - sway
        - sway-notification-center
        - swaybg
        - swayidle
        - taskwarrior
        - thefuck
        - thunar
        - thunar-archive-plugin
        - tshark
        - vagrant
        - vim
        - virt-manager
        - waybar
        - wdisplays
        - wireshark
        - wl-clipboard
        - wofi
        - zsh
      state: present
      update_cache: true

  - name: Install packages from pip
    ansible.builtin.pip:
      break_system_packages: true
      name:
        - ansible
        - rofimoji
      state: latest
    become: false # only break user packages, not system-wide 😏
    when: ansible_version.full is version('2.17', '>=') # you may need to update ansible first manually-ish

  - name: Make zsh the default shell
    user:
      name: "{{ ansible_user }}"
      shell: "/usr/bin/zsh"
